<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ product.name }} - Product Details</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .thumbnail {
            width: 80px;
            height: 80px;
            object-fit: cover;
            transition: all 0.3s ease;
        }

        .main-image-container {
            height: 400px;
            background-color: #f3f4f6;
        }

        .specs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }

        @media (max-width: 768px) {
            .main-image-container {
                height: 300px;
            }

            .specs-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body class="bg-gray-100">
    <div class="max-w-6xl mx-auto p-4 md:p-6">
        <!-- Back Button - Updated to go back to category -->
        <a href="/category/{{ product.category_id }}"
            class="inline-flex items-center text-indigo-600 hover:text-indigo-800 mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd"
                    d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z"
                    clip-rule="evenodd" />
            </svg>
            Back to {{ category.name }}
        </a>

        <!-- Product Main Section -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 p-6">
                <!-- Image Gallery -->
                <div>
                    <div class="main-image-container rounded-lg overflow-hidden flex items-center justify-center">
                        <img id="mainImage"
                            src="{{ product.images[0] if product.images else '/static/default-product.jpg' }}"
                            alt="{{ product.name }}" class="w-full h-full object-contain">
                    </div>

                    {% if product.images and product.images|length > 1 %}
                    <div class="mt-4 flex space-x-2 overflow-x-auto py-2">
                        {% for img_url in product.images %}
                        <img src="{{ img_url }}" alt="Thumbnail {{ loop.index }}"
                            class="thumbnail rounded-md cursor-pointer border-2 {{ 'border-indigo-500' if loop.first else 'border-transparent' }}"
                            onclick="changeMainImage(this, '{{ img_url }}')">
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>

                <!-- Product Info -->
                <div class="flex flex-col">
                    <h1 class="text-2xl md:text-3xl font-bold text-gray-800">{{ product.name }}</h1>

                    <div class="mt-4 flex items-center">
                        <span class="text-2xl font-semibold text-indigo-600">${{ product.price }}</span>
                    </div>

                    <div class="mt-6 space-y-4">
                        <a href="/inquire?product_id={{ product.id }}"
                            class="inline-flex items-center justify-center w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-3 px-6 rounded-lg transition">
                            ðŸ“© Request Information
                        </a>
                    </div>

                    <div class="mt-6 border-t pt-6">
                        <h2 class="text-xl font-semibold text-gray-800 mb-3">Description</h2>
                        <div class="text-gray-700 leading-relaxed">
                            {{ product.description }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Product Details Section -->
            <div class="bg-gray-50 p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Specifications</h2>
                <div class="specs-grid">
                    {% for key, value in product.specs.items() %}
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <h3 class="font-medium text-gray-900">{{ key }}</h3>
                        <p class="text-gray-700">{{ value }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Product Video Section -->
            {% if product.video_url %}
            <div class="p-6 border-t">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Product Video</h2>
                <div class="aspect-w-16 aspect-h-9">
                    <iframe class="w-full h-96 rounded-lg shadow-lg"
                        src="{{ product.video_url|replace('watch?v=', 'embed/') }}" frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen>
                    </iframe>
                </div>
            </div>
            {% endif %}

            <!-- Related Products Section -->
            {% if related_products %}
            <div class="p-6 border-t">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Related Products</h2>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                    {% for related in related_products %}
                    <a href="/product/{{ related.id }}" class="group">
                        <div class="bg-white p-3 rounded-lg shadow-sm hover:shadow-md transition-shadow">
                            <div class="h-40 bg-gray-200 rounded-md overflow-hidden flex items-center justify-center">
                                <img src="{{ related.images[0] if related.images else '/static/default-product.jpg' }}"
                                    alt="{{ related.name }}"
                                    class="h-full w-full object-contain group-hover:scale-105 transition-transform">
                            </div>
                            <h3 class="mt-2 text-sm font-medium text-gray-900 truncate">{{ related.name }}</h3>
                            <p class="text-sm text-indigo-600 font-semibold">${{ related.price }}</p>
                        </div>
                    </a>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <script>
        // Change main image when thumbnail is clicked
        function changeMainImage(element, imgUrl) {
            document.getElementById('mainImage').src = imgUrl;

            // Remove border from all thumbnails
            document.querySelectorAll('.thumbnail').forEach(thumb => {
                thumb.classList.remove('border-indigo-500');
                thumb.classList.add('border-transparent');
            });

            // Add border to selected thumbnail
            element.classList.remove('border-transparent');
            element.classList.add('border-indigo-500');
        }

        // Zoom functionality for main image
        document.getElementById('mainImage').addEventListener('click', function () {
            this.classList.toggle('object-contain');
            this.classList.toggle('object-scale-down');
        });
    </script>
</body>

</html>